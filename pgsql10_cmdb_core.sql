


--- export PGPASSWORD=<password>
--- psql -h <host> -d <database> -U <user_name> -p <port> -a -w -f <file>.sql



DROP SCHEMA aidb IF EXISTS;

CREATE SCHEMA aidb;


CREATE TABLE aidb.location (
    id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    country         text NOT NULL,
    state           text NOT NULL,
    town            text NOT NULL,
    street          text NOT NULL,
    zipcode         text NOT NULL
);

CREATE TABLE aidb.position (
    id              INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    building        INTEGER REFERENCES aidb.location (id),
    floor           INTEGER NOT NULL,
    room            text NOT NULL,
    rack            text NOT NULL,
    rack_position   text NOT NULL
);

CREATE INDEX position_id_index ON aidb.position (id);


---
--- COMPANY
---
CREATE TABLE aidb.contact (
    id integer      PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name            text NOT NULL,
    phone           text NOT NULL,
    phone2          text NOT NULL,
    email           text NOT NULL,
    other           text NOT NULL
);

CREATE TABLE aidb.corporation (
    id integer      PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name            text NOT NULL,
    tax_id          text NOT NULL,
    bank_acc        text NOT NULL,
    corp_address    INTEGER REFERENCES aidb.location (id),
    corp_contact    INTEGER REFERENCES aidb.contact (id),
    descr           text NOT NULL
);

CREATE TABLE aidb.department (
    id              INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    corp_id         INTEGER REFERENCES aidb.corporation (id),
    dept_contact    INTEGER REFERENCES aidb.contact (id),
    dept_name       text NOT NULL,
    dept_descr      text NOT NULL
);

CREATE TABLE aidb.project (
    id              INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    corp_id         INTEGER REFERENCES aidb.corporation (id),
    proj_contact    INTEGER REFERENCES aidb.contact (id),
    proj_name       text NOT NULL,
    proj_descr      text NOT NULL
);

CREATE TABLE aidb.employee (
    id              INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    dept_id         INTEGER REFERENCES aidb.department (id),
    dept_contact    INTEGER REFERENCES aidb.contact (id),
    descr           text NOT NULL
);

CREATE TABLE aidb.proj_member (
    id              INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    proj_id         INTEGER REFERENCES aidb.project (id),
    member          INTEGER REFERENCES aidb.employee (id),
    descr           text NOT NULL
);




---
--- HOST
---
CREATE TYPE host_type AS ENUM ('physical', 'virtual');

CREATE TABLE aidb.host (
    id              INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    ip_addr         inet NOT NULL,
    mac_addr        macaddr NOT NULL,
    hostname        text NOT NULL,
    host_t          host_type NOT NULL,
    dns_hostname    text NOT NULL DEFAULT 'localhost.localdomain'
);

CREATE INDEX host_id_index ON aidb.host (id);

CREATE TABLE aidb.physical_host (
    id              INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    building        INTEGER REFERENCES aidb.position (id),
    host            INTEGER REFERENCES aidb.host (id)
);
