


--- export PGPASSWORD=<password>
--- psql -h <host> -d <database> -U <user_name> -p <port> -a -w -f <file>.sql


DROP TABLE IF EXISTS cmdb_core.position, cmdb_core.location;
DROP SCHEMA cmdb_core;

CREATE SCHEMA cmdb_core;


CREATE TABLE cmdb_core.location (
    id integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    country         text NOT NULL,
    state           text NOT NULL,
    town            text NOT NULL,
    street          text NOT NULL,
    zipcode         text NOT NULL
);

CREATE TABLE cmdb_core.position (
    id              INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    building        INTEGER REFERENCES cmdb_core.location (id) ON DELETE CASCADE,
    floor           INTEGER NOT NULL,
    room            text NOT NULL,
    rack            text NOT NULL,
    rack_position   text NOT NULL
);

CREATE INDEX position_id_index ON cmdb_core.position (id);


--- HOST

CREATE TYPE host_type AS ENUM ('physical', 'virtual', 'cluster');

CREATE TABLE cmdb_core.host (
    id              INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    ip_addr         inet NOT NULL,
    mac_addr        macaddr NOT NULL,
    hostname        text NOT NULL,
    host_t          host_type NOT NULL,
    dns_hostname    text NOT NULL
);

CREATE TABLE cmdb_core.physical_host (
    id              INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    building        INTEGER REFERENCES cmdb_core.location (id) ON DELETE CASCADE,
    host            INTEGER REFERENCES cmdb_core.host (id) ON DELETE CASCADE,
);
